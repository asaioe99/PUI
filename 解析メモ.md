# 解析メモ
まずは、```g```によりクラッシュした瞬間まで進める。

```
0:000> g
(5ce4.160c): Access violation - code c0000005 (first/second chance not available)
First chance exceptions are reported before any exception handling.
This exception may be expected and handled.
Time Travel Position: 30145:0
eax=010d2f98 ebx=001927d8 ecx=010dfdd8 edx=0018c39c esi=010dfdd8 edi=00000001
eip=01075e3b esp=0018c36c ebp=0018c370 iopl=0         nv up ei pl nz na pe nc
cs=0023  ss=002b  ds=002b  es=002b  fs=0053  gs=002b             efl=00200206
01075e3b 01982f0d0103    add     dword ptr [eax+3010D2Fh],ebx ds:002b:040e3cc7=????????
```

Access違反で落ちている。```ptr [eax+3010D2Fh]=040e3cc7=????????```への```add```が直接の原因らしい。

周辺をアセンブリで読むと、

```
01075e38 c00001         rol     byte ptr [eax], 1           ds:002b:010d2f98=38
01075e3b 01982f0d0103   add     dword ptr [eax+3010D2Fh], ebx
01075e41 0200           add     al, byte ptr [eax]
01075e43 06             push    es
01075e44 61             popad   
01075e45 7261           jb      01075ea8
01075e47 6200           bound   eax, qword ptr [eax]
01075e49 26637972       arpl    word ptr es:[ecx+72h], di
01075e4d 6c             ins     byte ptr es:[edi], dx
01075e4e 007e67         add     byte ptr [esi+67h], bh
01075e51 656f           outs    dx, dword ptr gs:[esi]
01075e53 7200           jb      01075e55
01075e55 8c6865         mov     word ptr [eax+65h], gs
01075e58 627200         bound   esi, qword ptr [edx]
01075e5b 9a6c61746e00a6 call    A600:6E74616C
01075e62 7468           je      01075ecc
01075e64 61             popad   
01075e65 6900c4001c00   imul    eax, dword ptr [eax], 1C00C4h
01075e6b 0446           add     al, 46h
01075e6d 41             inc     ecx
01075e6e 52             push    edx
01075e6f 2000           and     byte ptr [eax], al
01075e71 284d4c         sub     byte ptr [ebp+4Ch], cl

以下略
```

確証はないが、text領域ではないし、正規の命令にも見えない。

そこでASCIIで見てみると、

```
0:000> dc 01075e38
01075e38  010100c0 010d2f98 06000203 62617261  ...../......arab
01075e48  79632600 7e006c72 726f6567 65688c00  .&cyrl.~geor..he
01075e58  9a007262 6e74616c 6874a600 c4006961  br..latn..thai..
01075e68  04001c00 20524146 4c4d2800 34002059  ....FAR .(MLY .4
01075e78  20444e53 52554000 4c002044 ffff0000  SND .@URD .L....
01075e88  00000300 10000500 ffff0000 01000300  ................
01075e98  11000600 ffff0000 02000300 12000700  ................
01075ea8  ffff0000 03000300 13000800 ffff0000  ................
```

言語名の様なものが伺えるため、何らかの文字列である。

そもそも、現在の実行アドレス（EIP）は一体どこなのだろうか。確認してみるべきだ。

```
0:000> !address eip
Address 01075e3b could not be mapped in any of the available regions
```

やはり分からない。不明なアドレスである。

念のために、当該加算先のアドレスを確認する。

```
0:000> dc 040e3cc7
040e3cc7  ???????? ???????? ???????? ????????  ????????????????
040e3cd7  ???????? ???????? ???????? ????????  ????????????????
040e3ce7  ???????? ???????? ???????? ????????  ????????????????
040e3cf7  ???????? ???????? ???????? ????????  ????????????????
040e3d07  ???????? ???????? ???????? ????????  ????????????????
040e3d17  ???????? ???????? ???????? ????????  ????????????????
040e3d27  ???????? ???????? ???????? ????????  ????????????????
040e3d37  ???????? ???????? ???????? ????????  ????????????????
```

アドレスの情報も見てみる。

```
0:000> !address 040e3cc7

                                     
Mapping file section regions...
Mapping module regions...
Mapping PEB regions...
Mapping TEB and stack regions...
Mapping heap regions...
Mapping page heap regions...
Mapping other regions...
Mapping stack trace database regions...
Mapping activation context regions...
Address 040e3cc7 could not be mapped in any of the available regions
```

残念ながら何も分からない。

ここで、```t-```により、一個前のコードに戻る。

```
0:000> t-
Time Travel Position: 30144:68
eax=010d2f98 ebx=001927d8 ecx=010dfdd8 edx=0018c39c esi=010dfdd8 edi=00000001
eip=01075e38 esp=0018c36c ebp=0018c370 iopl=0         nv up ei pl nz na pe nc
cs=0023  ss=002b  ds=002b  es=002b  fs=0053  gs=002b             efl=00200206
01075e38 c00001          rol     byte ptr [eax],1           ds:002b:010d2f98=38
```

更に進めると、

```
0:000> t-
Time Travel Position: 30144:67
eax=010d2f98 ebx=001927d8 ecx=010dfdd8 edx=0018c39c esi=010dfdd8 edi=00000001
eip=006784eb esp=0018c370 ebp=0018c370 iopl=0         nv up ei pl nz na pe nc
cs=0023  ss=002b  ds=002b  es=002b  fs=0053  gs=002b             efl=00200206
Jw_win+0x2784eb:
006784eb ff10            call    dword ptr [eax]      ds:002b:010d2f98=01075e38
```
```
006784e2 55             push    ebp
006784e3 8bec           mov     ebp, esp
006784e5 85c9           test    ecx, ecx
006784e7 7410           je      Jw_win+0x2784f9 (006784f9)
006784e9 8b01           mov     eax, dword ptr [ecx]
006784eb ff10           call    dword ptr [eax]      ds:002b:010d2f98=01075e38
006784ed 85c0           test    eax, eax
006784ef 7408           je      Jw_win+0x2784f9 (006784f9)
006784f1 8bc8           mov     ecx, eax
006784f3 5d             pop     ebp
006784f4 e9bfffffff     jmp     Jw_win+0x2784b8 (006784b8)
006784f9 e8b626ffff     call    Jw_win+0x26abb4 (0066abb4)
006784fe cc             int     3
006784ff 8bc1           mov     eax, ecx
00678501 c20400         ret     4
```

となる。関数として呼び出されたのだ。

呼び出し元では、```006784eb ff10           call    dword ptr [eax] ```を実行し、不明なアドレスへ飛んでしまったのだろう。
